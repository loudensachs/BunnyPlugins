(()=>{
"use strict";var $=(()=>{var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __esm=(fn,res)=>function(){return fn&&(res=(0,fn[__getOwnPropNames(fn)[0]])(fn=0)),res};var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(var keys=__getOwnPropNames(from),i=0,n=keys.length,key;i<n;i++)key=keys[i],!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:(k=>from[k]).bind(null,key),enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod)),__toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod);var define_DEFAULT_LANG_default,init_define_DEFAULT_LANG=__esm({"<define:DEFAULT_LANG>"(){define_DEFAULT_LANG_default={"toast.patch_error":"UserPFP couldn't patch avatars!","toast.fetch_error":"UserPFP couldn't fetch avatars!"}}});var require_vendetta=__commonJS({"vendetta:@vendetta"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta}});var require_plugin=__commonJS({"vendetta:@vendetta/plugin"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta.plugin}});var require_plugins=__commonJS({"vendetta:@vendetta/plugins"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta.plugins}});var require_assets=__commonJS({"vendetta:@vendetta/ui/assets"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta.ui.assets}});var require_toasts=__commonJS({"vendetta:@vendetta/ui/toasts"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta.ui.toasts}});var require_metro=__commonJS({"vendetta:@vendetta/metro"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta.metro}});var require_common=__commonJS({"vendetta:@vendetta/metro/common"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta.metro.common}});var require_patcher=__commonJS({"vendetta:@vendetta/patcher"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta.patcher}});var require_utils=__commonJS({"vendetta:@vendetta/utils"(exports,module){init_define_DEFAULT_LANG();module.exports=vendetta.utils}});var src_exports={};__export(src_exports,{dataURL:()=>dataURL,default:()=>src_default,enabled:()=>enabled,lang:()=>lang});init_define_DEFAULT_LANG();var import_vendetta2=__toESM(require_vendetta(),1),import_plugin=__toESM(require_plugin(),1),import_plugins=__toESM(require_plugins(),1),import_assets3=__toESM(require_assets(),1),import_toasts3=__toESM(require_toasts(),1);init_define_DEFAULT_LANG();var import_metro3=__toESM(require_metro(),1),import_common3=__toESM(require_common(),1);init_define_DEFAULT_LANG();var import_metro=__toESM(require_metro(),1),import_common=__toESM(require_common(),1),import_assets=__toESM(require_assets(),1),import_toasts=__toESM(require_toasts(),1),ThemeStore=(0,import_metro.findByStoreName)("ThemeStore"),{triggerHaptic}=(0,import_metro.findByProps)("triggerHaptic"),colorModule=(0,import_metro.findByProps)("colors","unsafe_rawColors"),colorResolver=colorModule?.internal??colorModule?.meta,{useThemeContext}=(0,import_metro.findByProps)("useThemeContext"),TextStyleSheet=(0,import_metro.findByProps)("TextStyleSheet").TextStyleSheet,Navigator=(0,import_metro.findByProps)("Navigator")?.Navigator,modalCloseButton=(0,import_metro.findByProps)("getHeaderCloseButton")?.getHeaderCloseButton,{popModal,pushModal}=(0,import_metro.findByProps)("popModal","pushModal");function fluxSubscribe(topic,callback,once){var cback=data2=>(callback(data2),once&&import_common.FluxDispatcher.unsubscribe(topic,cback));return import_common.FluxDispatcher.subscribe(topic,cback),()=>import_common.FluxDispatcher.unsubscribe(topic,cback)}init_define_DEFAULT_LANG();init_define_DEFAULT_LANG();var import_meta={};function createJSONStorage(getStorage,options){var storage;try{storage=getStorage()}catch{return}var persistStorage={getItem:name=>{var _a,parse=str2=>str2===null?null:JSON.parse(str2,options?.reviver),str=(_a=storage.getItem(name))!=null?_a:null;return str instanceof Promise?str.then(parse):parse(str)},setItem:(name,newValue)=>storage.setItem(name,JSON.stringify(newValue,options?.replacer)),removeItem:name=>storage.removeItem(name)};return persistStorage}var toThenable=fn=>input=>{try{var result=fn(input);return result instanceof Promise?result:{then(onFulfilled){return toThenable(onFulfilled)(result)},catch(_onRejected){return this}}}catch(e){return{then(_onFulfilled){return this},catch(onRejected){return toThenable(onRejected)(e)}}}},oldImpl=(config,baseOptions)=>(set,get,api)=>{var options={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:state=>state,version:0,merge:(persistedState,currentState)=>({...currentState,...persistedState}),...baseOptions},hasHydrated=!1,hydrationListeners=new Set,finishHydrationListeners=new Set,storage;try{storage=options.getStorage()}catch{}if(!storage)return config((...args)=>{console.warn(`[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`),set(...args)},get,api);var thenableSerialize=toThenable(options.serialize),setItem=()=>{var state=options.partialize({...get()}),errorInSync,thenable=thenableSerialize({state,version:options.version}).then(serializedValue=>storage.setItem(options.name,serializedValue)).catch(e=>{errorInSync=e});if(errorInSync)throw errorInSync;return thenable},savedSetState=api.setState;api.setState=(state,replace)=>{savedSetState(state,replace),setItem()};var configResult=config((...args)=>{set(...args),setItem()},get,api),stateFromStorage,hydrate=()=>{var _a;if(storage){hasHydrated=!1,hydrationListeners.forEach(cb=>cb(get()));var postRehydrationCallback=((_a=options.onRehydrateStorage)==null?void 0:_a.call(options,get()))||void 0;return toThenable(storage.getItem.bind(storage))(options.name).then(storageValue=>{if(storageValue)return options.deserialize(storageValue)}).then(deserializedStorageValue=>{if(deserializedStorageValue)if(typeof deserializedStorageValue.version=="number"&&deserializedStorageValue.version!==options.version){if(options.migrate)return options.migrate(deserializedStorageValue.state,deserializedStorageValue.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return deserializedStorageValue.state}).then(migratedState=>{var _a2;return stateFromStorage=options.merge(migratedState,(_a2=get())!=null?_a2:configResult),set(stateFromStorage,!0),setItem()}).then(()=>{postRehydrationCallback?.(stateFromStorage,void 0),hasHydrated=!0,finishHydrationListeners.forEach(cb=>cb(stateFromStorage))}).catch(e=>{postRehydrationCallback?.(void 0,e)})}};return api.persist={setOptions:newOptions=>{options={...options,...newOptions},newOptions.getStorage&&(storage=newOptions.getStorage())},clearStorage:()=>{storage?.removeItem(options.name)},getOptions:()=>options,rehydrate:()=>hydrate(),hasHydrated:()=>hasHydrated,onHydrate:cb=>(hydrationListeners.add(cb),()=>{hydrationListeners.delete(cb)}),onFinishHydration:cb=>(finishHydrationListeners.add(cb),()=>{finishHydrationListeners.delete(cb)})},hydrate(),stateFromStorage||configResult},newImpl=(config,baseOptions)=>(set,get,api)=>{var options={storage:createJSONStorage(()=>localStorage),partialize:state=>state,version:0,merge:(persistedState,currentState)=>({...currentState,...persistedState}),...baseOptions},hasHydrated=!1,hydrationListeners=new Set,finishHydrationListeners=new Set,storage=options.storage;if(!storage)return config((...args)=>{console.warn(`[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`),set(...args)},get,api);var setItem=()=>{var state=options.partialize({...get()});return storage.setItem(options.name,{state,version:options.version})},savedSetState=api.setState;api.setState=(state,replace)=>{savedSetState(state,replace),setItem()};var configResult=config((...args)=>{set(...args),setItem()},get,api);api.getInitialState=()=>configResult;var stateFromStorage,hydrate=()=>{var _a,_b;if(storage){hasHydrated=!1,hydrationListeners.forEach(cb=>{var _a2;return cb((_a2=get())!=null?_a2:configResult)});var postRehydrationCallback=((_b=options.onRehydrateStorage)==null?void 0:_b.call(options,(_a=get())!=null?_a:configResult))||void 0;return toThenable(storage.getItem.bind(storage))(options.name).then(deserializedStorageValue=>{if(deserializedStorageValue)if(typeof deserializedStorageValue.version=="number"&&deserializedStorageValue.version!==options.version){if(options.migrate)return[!0,options.migrate(deserializedStorageValue.state,deserializedStorageValue.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,deserializedStorageValue.state];return[!1,void 0]}).then(migrationResult=>{var _a2,[migrated,migratedState]=migrationResult;if(stateFromStorage=options.merge(migratedState,(_a2=get())!=null?_a2:configResult),set(stateFromStorage,!0),migrated)return setItem()}).then(()=>{postRehydrationCallback?.(stateFromStorage,void 0),stateFromStorage=get(),hasHydrated=!0,finishHydrationListeners.forEach(cb=>cb(stateFromStorage))}).catch(e=>{postRehydrationCallback?.(void 0,e)})}};return api.persist={setOptions:newOptions=>{options={...options,...newOptions},newOptions.storage&&(storage=newOptions.storage)},clearStorage:()=>{storage?.removeItem(options.name)},getOptions:()=>options,rehydrate:()=>hydrate(),hasHydrated:()=>hasHydrated,onHydrate:cb=>(hydrationListeners.add(cb),()=>{hydrationListeners.delete(cb)}),onFinishHydration:cb=>(finishHydrationListeners.add(cb),()=>{finishHydrationListeners.delete(cb)})},options.skipHydration||hydrate(),stateFromStorage||configResult},persistImpl=(config,baseOptions)=>"getStorage"in baseOptions||"serialize"in baseOptions||"deserialize"in baseOptions?((import_meta.env?import_meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),oldImpl(config,baseOptions)):newImpl(config,baseOptions),persist=persistImpl;init_define_DEFAULT_LANG();var constants_default={github:{url:"https://github.com/nexpid/BunnyPlugins/tree/main/",raw:"https://raw.githubusercontent.com/nexpid/BunnyPlugins/main/"}};init_define_DEFAULT_LANG();var import_metro2=__toESM(require_metro(),1),import_common2=__toESM(require_common(),1);var WebView=(0,import_metro2.find)(x=>x?.WebView&&!x.default).WebView,Svg=(0,import_metro2.findByProps)("SvgXml"),Reanimated=(0,import_metro2.findByProps)("useSharedValue"),FlashList=(0,import_metro2.findByProps)("FlashList").FlashList,{default:Video}=(0,import_metro2.findByProps)("DRMType","FilterType"),Joi=(0,import_metro2.findByProps)("isJoi"),zustand=(0,import_metro2.findByProps)("create","useStore")??{create:(0,import_metro2.findByName)("create")},DocumentPicker=(0,import_metro2.findByProps)("pickSingle","isCancel"),_MAS=(0,import_metro2.findByProps)("MobileAudioSound").MobileAudioSound;var RNCacheModule=import_common2.ReactNative.NativeModules.MMKVManager??import_common2.ReactNative.NativeModules.NativeCacheModule,RNChatModule=import_common2.ReactNative.NativeModules.DCDChatManager??import_common2.ReactNative.NativeModules.NativeChatModule,RNFileModule=import_common2.ReactNative.NativeModules.RTNFileManager??import_common2.ReactNative.NativeModules.DCDFileManager??import_common2.ReactNative.NativeModules.NativeFileModule;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var useLangStore=zustand.create(persist((set,get)=>({values:{},lastModified:null,update:function(){var _ref=_async_to_generator(function*(plugin){var res=yield fetch(`${constants_default.github.raw}lang/values/${plugin.toString()}.json`,{headers:{"if-modified-since":get().lastModified}});if(res.ok){var values=yield res.json();set({lastModified:res.headers.get("last-modified"),values})}});return function(plugin){return _ref.apply(this,arguments)}}()}),{name:"nexpid-lang",storage:createJSONStorage(()=>RNCacheModule),partialize:state=>({values:state.values,lastModified:state.lastModified}),onRehydrateStorage:()=>()=>RNCacheModule.removeItem("nexpid-lang")}));function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var IntlMessageFormat=(0,import_metro3.findByName)("MessageFormat"),Lang=function(){"use strict";function Lang2(plugin){_class_call_check(this,Lang2),_define_property(this,"plugin",void 0),_define_property(this,"_unload",void 0),_define_property(this,"Values",void 0),this.plugin=plugin,useLangStore.persist.setOptions({name:`nexpid-lang-${plugin.toString()}`,onRehydrateStorage:()=>state=>state?.update(this.plugin)}),useLangStore.persist.rehydrate(),this._unload=fluxSubscribe("I18N_LOAD_SUCCESS",()=>void useLangStore.persist.rehydrate())}return _create_class(Lang2,[{key:"unload",value:function(){this._unload()}},{key:"format",value:function(_key,input){var key=_key,locale=Lang2.getLang(),{values}=useLangStore.getState();if(!values)return String(key);var val=values[locale]?.[key]??values.en?.[key]??define_DEFAULT_LANG_default?.[key];return val?Object.keys(input).length>0?new IntlMessageFormat(val).format(input):val:String(key)}}],[{key:"getLang",value:function(){var lang2=import_common3.i18n.getLocale()?.replace(/-/g,"_")??"en";return lang2.startsWith("en_")?"en":lang2}},{key:"basicFormat",value:function(text){var rules=[{regex:/\*\*(.*?)\*\*/g,react:txt2=>React.createElement(import_common3.ReactNative.Text,{style:{fontWeight:"900"}},txt2)}],txt=text.split(""),off=0;for(var rule of rules){var matches=Array.from(text.matchAll(rule.regex));for(var match of matches)match[1]&&match.index&&(txt.splice(match.index-off,match[0].length,rule.react(match[1])),off+=match[0].length-1)}return txt}}]),Lang2}();init_define_DEFAULT_LANG();var import_vendetta=__toESM(require_vendetta(),1),import_metro4=__toESM(require_metro(),1),import_patcher=__toESM(require_patcher(),1),import_assets2=__toESM(require_assets(),1),import_toasts2=__toESM(require_toasts(),1),import_utils=__toESM(require_utils(),1);function asyncGeneratorStep2(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _async_to_generator2(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep2(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep2(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var avatarStuff=(0,import_metro4.findByProps)("getUserAvatarURL","getUserAvatarSource"),UserStore=(0,import_metro4.findByStoreName)("UserStore"),data,fetchData=function(){var _ref=_async_to_generator2(function*(){try{data=yield(yield(0,import_utils.safeFetch)(dataURL,{headers:{"cache-control":"max-age=1800"}})).json()}catch(e){import_vendetta.logger.error("fetch error",e),(0,import_toasts2.showToast)(lang.format("toast.fetch_error",{}),(0,import_assets2.getAssetIDByName)("CircleXIcon-primary"))}});return function(){return _ref.apply(this,arguments)}}(),getCustomAvatar=(id2,isStatic)=>{if(data.avatars[id2]){var avatar=data.avatars[id2];return isStatic&&urlExt(avatar)==="gif"?avatar.replace(".gif",".png"):avatar}},urlExt=url=>new URL(url).pathname.split(".").slice(-1)[0],patcher_default=_async_to_generator2(function*(){var patches=new Array;if(yield fetchData(),!data||!enabled)return()=>{};var dataInterval=setInterval(()=>void fetchData(),1e3*60*60);return patches.push(()=>{clearInterval(dataInterval)}),patches.push((0,import_patcher.after)("getUser",UserStore,([id2],ret)=>{var ext=data.avatars[id2]&&urlExt(data.avatars[id2]);if(ext==="gif"&&ret){var avatar=ret.avatar??"0";ret.avatar=avatar.startsWith("a_")?avatar:`a_${avatar}`}})),patches.push((0,import_patcher.after)("getUserAvatarURL",avatarStuff,([{id:id2},animate])=>getCustomAvatar(id2,!animate))),patches.push((0,import_patcher.after)("getUserAvatarSource",avatarStuff,([{id:id2},animate],ret)=>{var custom=getCustomAvatar(id2,!animate);if(custom)return custom?{uri:custom}:ret})),()=>{for(var x of patches)x()}});function asyncGeneratorStep3(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _async_to_generator3(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep3(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep3(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var dataURL="https://userpfp.github.io/UserPFP/source/data.json",enabled=!1,lang=new Lang("userpfp"),unpatch,src_default={onLoad:_async_to_generator3(function*(){enabled=!0;try{unpatch=yield patcher_default()}catch(e){import_vendetta2.logger.error("patch error",e),(0,import_toasts3.showToast)(lang.format("toast.patch_error",{}),(0,import_assets3.getAssetIDByName)("CircleXIcon-primary")),(0,import_plugins.stopPlugin)(import_plugin.id)}}),onUnload:()=>{enabled=!1,lang.unload(),unpatch()}};return __toCommonJS(src_exports);})();
return $;})();
