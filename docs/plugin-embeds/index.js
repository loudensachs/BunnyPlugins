(()=>{
"use strict";var $=(()=>{var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(var keys=__getOwnPropNames(from),i=0,n=keys.length,key;i<n;i++)key=keys[i],!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:(k=>from[k]).bind(null,key),enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod)),__toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod);var require_vendetta=__commonJS({"vendetta:@vendetta"(exports,module){module.exports=vendetta}});var require_constants=__commonJS({"vendetta:@vendetta/constants"(exports,module){module.exports=vendetta.constants}});var require_metro=__commonJS({"vendetta:@vendetta/metro"(exports,module){module.exports=vendetta.metro}});var require_patcher=__commonJS({"vendetta:@vendetta/patcher"(exports,module){module.exports=vendetta.patcher}});var require_plugins=__commonJS({"vendetta:@vendetta/plugins"(exports,module){module.exports=vendetta.plugins}});var require_assets=__commonJS({"vendetta:@vendetta/ui/assets"(exports,module){module.exports=vendetta.ui.assets}});var require_toasts=__commonJS({"vendetta:@vendetta/ui/toasts"(exports,module){module.exports=vendetta.ui.toasts}});var require_common=__commonJS({"vendetta:@vendetta/metro/common"(exports,module){module.exports=vendetta.metro.common}});var require_ui=__commonJS({"vendetta:@vendetta/ui"(exports,module){module.exports=vendetta.ui}});var src_exports={};__export(src_exports,{onLoad:()=>onLoad,onUnload:()=>onUnload});var import_vendetta=__toESM(require_vendetta(),1),import_constants=__toESM(require_constants(),1),import_metro4=__toESM(require_metro(),1),import_patcher=__toESM(require_patcher(),1),import_plugins2=__toESM(require_plugins(),1),import_assets2=__toESM(require_assets(),1),import_toasts2=__toESM(require_toasts(),1);var import_metro=__toESM(require_metro(),1),import_common=__toESM(require_common(),1);var WebView=(0,import_metro.find)(x=>x?.WebView&&!x.default).WebView,Svg=(0,import_metro.findByProps)("SvgXml"),Reanimated=(0,import_metro.findByProps)("useSharedValue"),FlashList=(0,import_metro.findByProps)("FlashList").FlashList,{default:Video}=(0,import_metro.findByProps)("DRMType","FilterType"),Joi=(0,import_metro.findByProps)("isJoi"),zustand=(0,import_metro.findByProps)("create","useStore")??{create:(0,import_metro.findByName)("create")},DocumentPicker=(0,import_metro.findByProps)("pickSingle","isCancel"),_MAS=(0,import_metro.findByProps)("MobileAudioSound").MobileAudioSound;var RNCacheModule=import_common.ReactNative.NativeModules.MMKVManager??import_common.ReactNative.NativeModules.NativeCacheModule,RNChatModule=import_common.ReactNative.NativeModules.DCDChatManager??import_common.ReactNative.NativeModules.NativeChatModule,RNFileModule=import_common.ReactNative.NativeModules.RTNFileManager??import_common.ReactNative.NativeModules.DCDFileManager??import_common.ReactNative.NativeModules.NativeFileModule;var import_metro2=__toESM(require_metro(),1),import_common2=__toESM(require_common(),1),MessageStore=(0,import_metro2.findByStoreName)("MessageStore"),pluginInstallingCache={},pluginMessageCache={},updateMessages=(plugin,installing)=>{if(installing!==void 0&&(pluginInstallingCache[plugin]=installing),pluginMessageCache[plugin])for(var[id,channel]of pluginMessageCache[plugin]){var message=MessageStore.getMessage(channel,id);message&&import_common2.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...message,content:message.content.endsWith(" ")?message.content.slice(0,-1):`${message.content} `},log_edit:!1})}};var import_plugins=__toESM(require_plugins(),1),import_ui=__toESM(require_ui(),1);var import_metro3=__toESM(require_metro(),1),import_common3=__toESM(require_common(),1),import_assets=__toESM(require_assets(),1),import_toasts=__toESM(require_toasts(),1),ThemeStore=(0,import_metro3.findByStoreName)("ThemeStore"),{triggerHaptic}=(0,import_metro3.findByProps)("triggerHaptic"),colorModule=(0,import_metro3.findByProps)("colors","unsafe_rawColors"),colorResolver=colorModule?.internal??colorModule?.meta,{useThemeContext}=(0,import_metro3.findByProps)("useThemeContext"),TextStyleSheet=(0,import_metro3.findByProps)("TextStyleSheet").TextStyleSheet,Navigator=(0,import_metro3.findByProps)("Navigator")?.Navigator,modalCloseButton=(0,import_metro3.findByProps)("getHeaderCloseButton")?.getHeaderCloseButton,{popModal,pushModal}=(0,import_metro3.findByProps)("popModal","pushModal");function resolveSemanticColor(color,theme=ThemeStore.theme){return colorResolver?.resolveSemanticColor(theme,color)}function androidifyColor(color,alpha=255){var[_,r,g,b]=color.match(/#([A-F0-9]{2})([A-F0-9]{2})([A-F0-9]{2})/i)??[];return _?(alpha&255)<<24|(Number.parseInt(r,16)&255)<<16|(Number.parseInt(g,16)&255)<<8|Number.parseInt(b,16)&255:0}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var pluginInfoCache={},getPluginInfo=plugin=>pluginInfoCache[plugin]!==void 0?{res:pluginInfoCache[plugin]}:import_plugins.plugins[plugin]?{res:pluginInfoCache[plugin]=import_plugins.plugins[plugin].manifest}:{res:!1,promise:_async_to_generator(function*(){try{pluginInfoCache[plugin]=yield(yield fetch(`${plugin}manifest.json`,{headers:{"cache-control":"public; max-age=30"}})).json()}catch{pluginInfoCache[plugin]=null}return updateMessages(plugin),pluginInfoCache[plugin]})()},getCodedLink=plugin=>{var obj={borderColor:0,backgroundColor:androidifyColor(resolveSemanticColor(import_ui.semanticColors.BACKGROUND_SECONDARY)),thumbnailCornerRadius:0,headerColor:androidifyColor(resolveSemanticColor(import_ui.semanticColors.HEADER_PRIMARY)),headerText:"",acceptLabelBackgroundColor:0,titleText:"",type:null,extendedType:4,participantAvatarUris:[],acceptLabelText:"",noParticipantsText:"",ctaEnabled:!1,plugin},info=getPluginInfo(plugin).res,installing=pluginInstallingCache[plugin];if(info===!1)obj.headerText="...";else if(info===null)obj.headerText="unknown plugin";else{obj.titleText=info.name,obj.noParticipantsText=`
${info.description}`,obj.ctaEnabled=!installing;var has=!!import_plugins.plugins[plugin];obj.acceptLabelBackgroundColor=androidifyColor(resolveSemanticColor(!has||installing?import_ui.semanticColors.BUTTON_POSITIVE_BACKGROUND:import_ui.semanticColors.BUTTON_DANGER_BACKGROUND)),obj.acceptLabelText=installing?"...":has?"Uninstall Plugin":"Install Plugin"}return obj};var codedLinksCache={},{MessagesHandlers}=(0,import_metro4.findByProps)("MessagesHandlers"),patcher_default=()=>{var patches=new Array;patches.push((0,import_patcher.before)("updateRows",RNChatModule,args=>{var _loop=function(row2){var plugins3=new Array,iterate=thing=>{for(var x of Array.isArray(thing)?thing:[thing])if(typeof x.content=="string"){var _loop2=function(url2){[import_vendetta.constants.PROXY_PREFIX,"https://vendetta.nexpid.xyz/",/^https?:\/\/\w+\.github\.io\//i].some(x2=>x2 instanceof RegExp?x2.test(url2.toLowerCase()):url2.toLowerCase().startsWith(x2.toLowerCase()))&&plugins3.push(url2.endsWith("/")?url2:`${url2}/`)};for(var url of x.content.match(import_constants.HTTP_REGEX_MULTI)??[])_loop2(url)}else if(typeof x.content=="object"&&x.content!==null){iterate(x.content);return}};if(row2.message){row2.message.content&&iterate(row2.message.content);for(var[plug,ids]of Object.entries(pluginMessageCache))ids.find(x=>x[0]===row2.message.id)&&!plugins3.includes(plug)&&(ids.length===1?delete pluginMessageCache[plug]:pluginMessageCache[plug]=ids.filter(x=>x[0]!==row2.message.id));plugins3[0]&&(codedLinksCache[row2.message.id]={});for(var plugin of plugins3)pluginMessageCache[plugin]??=[],pluginMessageCache[plugin].find(x=>x[0]===row2.message.id)||pluginMessageCache[plugin].push([row2.message.id,row2.message.channelId]),row2.message.codedLinks??=[],codedLinksCache[row2.message.id][row2.message.codedLinks.push(getCodedLink(plugin))-1]=plugin}},rows=JSON.parse(args[1]);for(var row of rows)_loop(row);args[1]=JSON.stringify(rows)}));var patchHandlers=handlers=>{handlers.__ple_patched||(handlers.__ple_patched=!0,Object.prototype.hasOwnProperty.call(handlers,"handleTapInviteEmbed")&&patches.push((0,import_patcher.instead)("handleTapInviteEmbed",handlers,(args,orig)=>{var[{nativeEvent:{index,messageId}}]=args,plugin=codedLinksCache[messageId][index];if(!plugin)return orig.call(void 0,...args);var has=!!import_plugins2.plugins[plugin];if(has){try{(0,import_plugins2.removePlugin)(plugin)}catch(e){console.log(e),(0,import_toasts2.showToast)("Failed to uninstall plugin!",(0,import_assets2.getAssetIDByName)("CircleXIcon-primary"))}updateMessages(plugin,!1)}else updateMessages(plugin,!0),(0,import_plugins2.installPlugin)(plugin).then(()=>{(0,import_toasts2.showToast)(`Successfully installed ${import_plugins2.plugins[plugin].manifest.name}.`,(0,import_assets2.getAssetIDByName)("CircleCheckIcon-primary"))}).catch(e=>{console.log(e),(0,import_toasts2.showToast)("Failed to install plugin!",(0,import_assets2.getAssetIDByName)("CircleXIcon-primary"))}).finally(()=>{updateMessages(plugin,!1)})})),patches.push(()=>handlers.__ple_patched=!1))},origGetParams=Object.getOwnPropertyDescriptor(MessagesHandlers.prototype,"params")?.get;return origGetParams&&Object.defineProperty(MessagesHandlers.prototype,"params",{configurable:!0,get(){return this&&patchHandlers(this),origGetParams.call(this)}}),patches.push(()=>origGetParams&&Object.defineProperty(MessagesHandlers.prototype,"params",{configurable:!0,get:origGetParams})),()=>{for(var x of patches)x()}};var unpatch,onLoad=()=>unpatch=patcher_default(),onUnload=()=>{unpatch()};return __toCommonJS(src_exports);})();
return $;})();
