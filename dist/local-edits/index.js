(()=>{
"use strict";var $=(()=>{var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(var keys=__getOwnPropNames(from),i=0,n=keys.length,key;i<n;i++)key=keys[i],!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:(k=>from[k]).bind(null,key),enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod)),__toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod);var require_plugin=__commonJS({"vendetta:@vendetta/plugin"(exports,module){module.exports=vendetta.plugin}});var require_common=__commonJS({"vendetta:@vendetta/metro/common"(exports,module){module.exports=vendetta.metro.common}});var require_components=__commonJS({"vendetta:@vendetta/ui/components"(exports,module){module.exports=vendetta.ui.components}});var require_alerts=__commonJS({"vendetta:@vendetta/ui/alerts"(exports,module){module.exports=vendetta.ui.alerts}});var require_assets=__commonJS({"vendetta:@vendetta/ui/assets"(exports,module){module.exports=vendetta.ui.assets}});var require_toasts=__commonJS({"vendetta:@vendetta/ui/toasts"(exports,module){module.exports=vendetta.ui.toasts}});var require_storage=__commonJS({"vendetta:@vendetta/storage"(exports,module){module.exports=vendetta.storage}});var require_ui=__commonJS({"vendetta:@vendetta/ui"(exports,module){module.exports=vendetta.ui}});var require_metro=__commonJS({"vendetta:@vendetta/metro"(exports,module){module.exports=vendetta.metro}});var require_patcher=__commonJS({"vendetta:@vendetta/patcher"(exports,module){module.exports=vendetta.patcher}});var require_utils=__commonJS({"vendetta:@vendetta/utils"(exports,module){module.exports=vendetta.utils}});var src_exports={};__export(src_exports,{default:()=>src_default,getEdit:()=>getEdit,setEdit:()=>setEdit,vstorage:()=>vstorage});var import_plugin3=__toESM(require_plugin(),1);var import_common3=__toESM(require_common(),1),import_components=__toESM(require_components(),1),import_alerts=__toESM(require_alerts(),1),import_assets2=__toESM(require_assets(),1),import_toasts2=__toESM(require_toasts(),1),import_storage=__toESM(require_storage(),1),import_plugin=__toESM(require_plugin(),1);var import_common4=__toESM(require_common(),1),import_ui2=__toESM(require_ui(),1);var import_metro2=__toESM(require_metro(),1),import_common2=__toESM(require_common(),1),import_ui=__toESM(require_ui(),1);var import_metro=__toESM(require_metro(),1),import_common=__toESM(require_common(),1),import_assets=__toESM(require_assets(),1),import_toasts=__toESM(require_toasts(),1),ThemeStore=(0,import_metro.findByStoreName)("ThemeStore"),{triggerHaptic}=(0,import_metro.findByProps)("triggerHaptic"),colorModule=(0,import_metro.findByProps)("colors","unsafe_rawColors"),colorResolver=colorModule?.internal??colorModule?.meta,{useThemeContext}=(0,import_metro.findByProps)("useThemeContext"),TextStyleSheet=(0,import_metro.findByProps)("TextStyleSheet").TextStyleSheet,Navigator=(0,import_metro.findByProps)("Navigator")?.Navigator,modalCloseButton=(0,import_metro.findByProps)("getHeaderCloseButton")?.getHeaderCloseButton,{popModal,pushModal}=(0,import_metro.findByProps)("popModal","pushModal");function resolveSemanticColor(color,theme=ThemeStore.theme){return colorResolver?.resolveSemanticColor(theme,color)}var{useThemeContext:useThemeContext2}=(0,import_metro2.findByProps)("useThemeContext");function Text({variant,lineClamp,color,align,style,onPress,getChildren,children,liveUpdate,ellipsis}){var themeContext=useThemeContext2(),[_,forceUpdate]=import_common2.React.useReducer(x=>~x,0);return import_common2.React.useEffect(()=>{if(liveUpdate){var nextSecond=()=>Date.now()-new Date().setMilliseconds(1e3),timeout=setTimeout(function update(){forceUpdate(),timeout=setTimeout(update,nextSecond())},nextSecond());return()=>clearTimeout(timeout)}},[]),import_common2.React.createElement(import_common2.ReactNative.Text,{style:[variant&&TextStyleSheet[variant],color?{color:resolveSemanticColor(import_ui.semanticColors[color],themeContext?.theme)}:{},align&&{textAlign:align},style??{}],numberOfLines:lineClamp,onPress,ellipsizeMode:ellipsis},getChildren?.()??children)}var styles=import_common3.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:import_ui2.semanticColors.TEXT_DANGER}}),destructiveText={color:"TEXT_DANGER",variant:"text-md/semibold"},{FormIcon,FormSwitchRow,FormRow}=import_components.Forms;import_plugin.storage.saveEditsOnUnload??=!0;var Settings_default=()=>((0,import_storage.useProxy)(import_plugin.storage),(0,import_storage.useProxy)(vstorage),React.createElement(import_common3.ReactNative.ScrollView,null,React.createElement(FormSwitchRow,{label:"Save Edits on Unload",leading:React.createElement(FormIcon,{source:(0,import_assets2.getAssetIDByName)("ic_block")}),onValueChange:v=>import_plugin.storage.saveEditsOnUnload=v,value:import_plugin.storage.saveEditsOnUnload}),React.createElement(FormRow,{label:React.createElement(Text,destructiveText,"Clear Edits"),leading:React.createElement(FormRow.Icon,{style:styles.destructiveIcon,source:(0,import_assets2.getAssetIDByName)("TrashIcon")}),onPress:()=>{(0,import_alerts.showConfirmationAlert)({title:"Clear Edits",content:"Are you sure you want to clear all local edits?",confirmText:"Clear",confirmColor:"red",onConfirm:()=>{var messagesToUpdate=[];for(var channel in vstorage.edits)for(var msgId in vstorage.edits[channel]){var editInfo=vstorage.edits[channel][msgId];messagesToUpdate.push({channel_id:channel,id:msgId,content:editInfo.originalContent})}vstorage.edits={};for(var msg of messagesToUpdate)import_common4.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:msg});(0,import_toasts2.showToast)("All local edits cleared",(0,import_assets2.getAssetIDByName)("TrashIcon"))},isDismissable:!0})}})));var import_metro7=__toESM(require_metro(),1),import_common10=__toESM(require_common(),1),import_patcher=__toESM(require_patcher(),1),import_plugin2=__toESM(require_plugin(),1);var import_metro3=__toESM(require_metro(),1),import_common5=__toESM(require_common(),1),import_utils=__toESM(require_utils(),1),_ActionSheet=(0,import_metro3.findByProps)("ActionSheet")?.ActionSheet??(0,import_metro3.find)(x=>x.render?.name==="ActionSheet"),{ActionSheetTitleHeader,ActionSheetCloseButton}=(0,import_metro3.findByProps)("ActionSheetTitleHeader","ActionSheetCloseButton"),LazyActionSheet=(0,import_metro3.findByProps)("openLazy","hideActionSheet"),{openLazy,hideActionSheet}=LazyActionSheet,{showSimpleActionSheet}=(0,import_metro3.findByProps)("showSimpleActionSheet"),ActionSheet=props=>React.createElement(_ActionSheet,null,React.createElement(ActionSheetTitleHeader,{title:props.title,trailing:React.createElement(ActionSheetCloseButton,{onPress:props.onClose??(()=>{hideActionSheet()})})}),React.createElement(import_common5.ReactNative.View,(0,import_utils.without)(props,"title","onClose")));ActionSheet.open=(sheet,props)=>{openLazy(new Promise(res=>{res({default:sheet})}),"ActionSheet",props)};var import_utils2=__toESM(require_utils(),1);var import_metro4=__toESM(require_metro()),import_common6=__toESM(require_common()),import_ui3=__toESM(require_ui()),{ActionSheetRow}=(0,import_metro4.findByProps)("ActionSheetRow"),{FormRow:FormRow2}=(0,import_metro4.findByProps)("FormRow");function RedesignRow({label,icon,onPress}){var styles2=import_common6.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:import_ui3.semanticColors.INTERACTIVE_NORMAL}});return ActionSheetRow?React.createElement(ActionSheetRow,{label,icon:React.createElement(ActionSheetRow.Icon,{source:icon,IconComponent:()=>React.createElement(import_common6.ReactNative.Image,{resizeMode:"cover",style:styles2.iconComponent,source:icon})}),onPress}):React.createElement(FormRow2,{label,leading:React.createElement(FormRow2.Icon,{source:icon}),onPress})}var import_common7=__toESM(require_common()),import_metro5=__toESM(require_metro()),import_components2=__toESM(require_components()),{showUserProfile}=(0,import_metro5.findByProps)("showUserProfile"),{fetchProfile}=(0,import_metro5.findByProps)("fetchProfile"),UserStore=(0,import_metro5.findByStoreName)("UserStore"),{Text:Text2}=import_components2.General,{TextStyleSheet:TextStyleSheet2}=(0,import_metro5.findByProps)("TextStyleSheet");var import_assets3=__toESM(require_assets(),1),import_alerts2=__toESM(require_alerts(),1),import_toasts3=__toESM(require_toasts(),1);var import_common8=__toESM(require_common(),1);function MessageActionSheetButton_default(message){return React.createElement(RedesignRow,{label:"Edit Local Message",icon:(0,import_assets3.getAssetIDByName)("PencilIcon"),onPress:()=>{var initValue=message?.content.toString(),edit=getEdit(message.channel_id,message.id);edit&&(initValue=edit.newContent),(0,import_alerts2.showInputAlert)({title:"Edit Local Message",confirmText:"Edit",onConfirm:newContent=>{var currentEdit=getEdit(message.channel_id,message.id),originalContent=currentEdit?.originalContent??message.content;setEdit(message.channel_id,message.id,newContent,originalContent),(0,import_toasts3.showToast)("Message edited locally",(0,import_assets3.getAssetIDByName)("PencilIcon")),import_common8.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...message,content:newContent}})},placeholder:"Edited message content..",initialValue:initValue}),hideActionSheet()}})}var import_metro6=__toESM(require_metro(),1),import_common9=__toESM(require_common(),1),{intl,t:intlMap}=(0,import_metro6.findByProps)("intl")??{},{runtimeHashMessageKey}=(0,import_metro6.findByProps)("runtimeHashMessageKey")??{},isUsingi18n=!!import_common9.i18n.Messages.DISCORD||!intl||!intlMap||!runtimeHashMessageKey,_messages={},intlProxy=Object.freeze(new Proxy(_messages,{get(trg,prop,receiv){var key=prop.toString();if(key in _messages)return Reflect.get(trg,key,receiv);if(isUsingi18n)return _messages[key]=import_common9.i18n.Messages[key];var hash=runtimeHashMessageKey(key);try{return _messages[key]=intl.string(intlMap[hash])}catch(e){return console.warn(`intlProxy: Failed to get intl message for key: ${key} (${hash})`,e),_messages[key]=""}}})),_format={},intlFormat=Object.freeze(new Proxy(_format,{get(trg,prop,receiv){var key=prop.toString();if(key in _format)return Reflect.get(trg,key,receiv);if(isUsingi18n)return _format[key]=typeof import_common9.i18n.Messages[key]=="string"?()=>import_common9.i18n.Messages[key]:import_common9.i18n.Messages[key].format;var hash=runtimeHashMessageKey(key);try{return _format[key]=values=>intl.format(intlMap[hash],values)}catch(e){return console.warn(`intlFormat: Failed to get intl format message for key: ${key} (${hash})`,e),_format[key]=()=>""}}})),intlProxy_default=intlProxy;function patcher_default(){var patches=[];patches.push((0,import_patcher.before)("openLazy",LazyActionSheet,([component,key,msg])=>{var message=msg?.message;key!=="MessageLongPressActionSheet"||!message||component.then(i=>{var unp=(0,import_patcher.after)("default",i,(_,comp)=>{import_common10.React.useEffect(()=>()=>{unp()},[]);var buttons=(0,import_utils2.findInReactTree)(comp,x=>x[0]?.type?.name==="ButtonRow");if(!buttons)return comp;var at=Math.max(buttons.findIndex(x=>x.props.message===intlProxy_default.MARK_UNREAD),0);buttons.splice(at,0,import_common10.React.createElement(MessageActionSheetButton_default,message))})})}));var RowManager=(0,import_metro7.findByName)("RowManager");return patches.push((0,import_patcher.after)("generate",RowManager.prototype,([data],row)=>{if(!(data.rowType!==1||!data.message)){var editInfo=getEdit(data.message.channel_id,data.message.id);editInfo&&import_plugin2.default?row.message.content=editInfo.newContent:editInfo&&!import_plugin2.default&&(row.message.content=editInfo.originalContent??data.message.content),data.message.__vml_deleted&&(row.message.edited="deleted",row.message.state="SEND_FAILED")}})),()=>{for(var unpatch2 of patches)unpatch2()}}var vstorage=import_plugin3.storage;function setEdit(channel,id,newContent,originalContent){vstorage.edits[channel]??={},vstorage.edits[channel][id]={newContent,originalContent}}function getEdit(channel,id){return vstorage.edits[channel]?.[id]}var unpatch,src_default={onLoad:()=>{vstorage.edits??={},vstorage.saveEditsOnUnload===void 0&&(vstorage.saveEditsOnUnload=!0),vstorage.saveEditsOnUnload||(vstorage.edits={}),unpatch=patcher_default()},onUnload:()=>{vstorage.saveEditsOnUnload||(vstorage.edits={}),unpatch()},settings:Settings_default};return __toCommonJS(src_exports);})();
return $;})();
