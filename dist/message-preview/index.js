(()=>{
"use strict";var $=(()=>{var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(var keys=__getOwnPropNames(from),i=0,n=keys.length,key;i<n;i++)key=keys[i],!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:(k=>from[k]).bind(null,key),enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod)),__toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod);var require_plugin=__commonJS({"vendetta:@vendetta/plugin"(exports,module){module.exports=vendetta.plugin}});var require_common=__commonJS({"vendetta:@vendetta/metro/common"(exports,module){module.exports=vendetta.metro.common}});var require_storage=__commonJS({"vendetta:@vendetta/storage"(exports,module){module.exports=vendetta.storage}});var require_assets=__commonJS({"vendetta:@vendetta/ui/assets"(exports,module){module.exports=vendetta.ui.assets}});var require_components=__commonJS({"vendetta:@vendetta/ui/components"(exports,module){module.exports=vendetta.ui.components}});var require_ui=__commonJS({"vendetta:@vendetta/ui"(exports,module){module.exports=vendetta.ui}});var require_metro=__commonJS({"vendetta:@vendetta/metro"(exports,module){module.exports=vendetta.metro}});var require_toasts=__commonJS({"vendetta:@vendetta/ui/toasts"(exports,module){module.exports=vendetta.ui.toasts}});var require_patcher=__commonJS({"vendetta:@vendetta/patcher"(exports,module){module.exports=vendetta.patcher}});var require_utils=__commonJS({"vendetta:@vendetta/utils"(exports,module){module.exports=vendetta.utils}});var require_alerts=__commonJS({"vendetta:@vendetta/ui/alerts"(exports,module){module.exports=vendetta.ui.alerts}});var src_exports={};__export(src_exports,{default:()=>src_default,vstorage:()=>vstorage});var import_plugin=__toESM(require_plugin(),1);var import_common4=__toESM(require_common(),1),import_storage=__toESM(require_storage(),1),import_assets2=__toESM(require_assets(),1),import_components=__toESM(require_components(),1);var import_common3=__toESM(require_common(),1),import_ui2=__toESM(require_ui(),1);var import_metro2=__toESM(require_metro(),1),import_common2=__toESM(require_common(),1),import_ui=__toESM(require_ui(),1);var import_metro=__toESM(require_metro(),1),import_common=__toESM(require_common(),1),import_assets=__toESM(require_assets(),1),import_toasts=__toESM(require_toasts(),1),ThemeStore=(0,import_metro.findByStoreName)("ThemeStore"),{triggerHaptic}=(0,import_metro.findByProps)("triggerHaptic"),colorModule=(0,import_metro.findByProps)("colors","unsafe_rawColors"),colorResolver=colorModule?.internal??colorModule?.meta,{useThemeContext}=(0,import_metro.findByProps)("useThemeContext"),TextStyleSheet=(0,import_metro.findByProps)("TextStyleSheet").TextStyleSheet,Navigator=(0,import_metro.findByProps)("Navigator")?.Navigator,modalCloseButton=(0,import_metro.findByProps)("getHeaderCloseButton")?.getHeaderCloseButton,{popModal,pushModal}=(0,import_metro.findByProps)("popModal","pushModal");function resolveSemanticColor(color,theme=ThemeStore.theme){return colorResolver?.resolveSemanticColor(theme,color)}var{useThemeContext:useThemeContext2}=(0,import_metro2.findByProps)("useThemeContext");function Text({variant,lineClamp,color,align,style,onPress,getChildren,children,liveUpdate,ellipsis}){var themeContext=useThemeContext2(),[_,forceUpdate]=import_common2.React.useReducer(x=>~x,0);return import_common2.React.useEffect(()=>{if(liveUpdate){var nextSecond=()=>Date.now()-new Date().setMilliseconds(1e3),timeout=setTimeout(function update(){forceUpdate(),timeout=setTimeout(update,nextSecond())},nextSecond());return()=>clearTimeout(timeout)}},[]),import_common2.React.createElement(import_common2.ReactNative.Text,{style:[variant&&TextStyleSheet[variant],color?{color:resolveSemanticColor(import_ui.semanticColors[color],themeContext?.theme)}:{},align&&{textAlign:align},style??{}],numberOfLines:lineClamp,onPress,ellipsizeMode:ellipsis},getChildren?.()??children)}function BetterTableRowTitle({title,onPress,icon,padding}){var styles2=import_common3.stylesheet.createThemedStyleSheet({androidRipple:{color:import_ui2.semanticColors.ANDROID_RIPPLE,cornerRadius:4},icon:{width:16,height:16,marginTop:1.5,tintColor:import_ui2.semanticColors.TEXT_MUTED}}),UseCompontent=onPress?import_common3.ReactNative.Pressable:import_common3.ReactNative.View;return React.createElement(UseCompontent,{android_ripple:styles2.androidRipple,onPress,style:{marginBottom:8,marginHorizontal:padding?16:0,marginTop:padding?8:0,gap:4,flexDirection:"row",alignItems:"center"}},icon&&React.createElement(import_common3.ReactNative.Image,{style:styles2.icon,source:icon,resizeMode:"cover"}),React.createElement(Text,{variant:"text-sm/semibold",color:"TEXT_MUTED"},title))}function BetterTableRowGroup({title,onTitlePress,icon,children,padding,nearby}){var styles2=import_common3.stylesheet.createThemedStyleSheet({main:{backgroundColor:import_ui2.semanticColors.CARD_PRIMARY_BG,borderColor:import_ui2.semanticColors.BORDER_FAINT,borderWidth:1,borderRadius:16,overflow:"hidden",flex:1}});return React.createElement(import_common3.ReactNative.View,{style:{marginHorizontal:16,marginTop:nearby?8:16}},title?typeof title=="string"?React.createElement(BetterTableRowTitle,{title,onPress:onTitlePress,icon}):title:null,React.createElement(import_common3.ReactNative.View,{style:styles2.main},padding?React.createElement(import_common3.ReactNative.View,{style:{paddingHorizontal:16,paddingVertical:16}},children):children))}var{FormRow,FormRadioRow}=import_components.Forms;function Settings_default(){return(0,import_storage.useProxy)(vstorage),React.createElement(import_common4.ReactNative.ScrollView,null,React.createElement(BetterTableRowGroup,{title:"Settings",icon:(0,import_assets2.getAssetIDByName)("SettingsIcon")},React.createElement(FormRow,{label:"Button type",leading:React.createElement(FormRow.Icon,{source:(0,import_assets2.getAssetIDByName)("PencilIcon")})}),React.createElement(FormRadioRow,{label:"Floating Pill",onPress:()=>vstorage.buttonType="pill",trailing:React.createElement(FormRow.Arrow,null),selected:vstorage.buttonType==="pill",style:{marginHorizontal:12}}),React.createElement(FormRadioRow,{label:"Send button",subLabel:"Holding the send button",onPress:()=>vstorage.buttonType="send",trailing:React.createElement(FormRow.Arrow,null),selected:vstorage.buttonType==="send",style:{marginHorizontal:12}}),React.createElement(FormRow,{label:"Preview type",leading:React.createElement(FormRow.Icon,{source:(0,import_assets2.getAssetIDByName)("PencilIcon")})}),React.createElement(FormRadioRow,{label:"Popup",onPress:()=>vstorage.previewType="popup",trailing:React.createElement(FormRow.Arrow,null),selected:vstorage.previewType==="popup",style:{marginHorizontal:12}}),React.createElement(FormRadioRow,{label:"Ephemeral message",onPress:()=>vstorage.previewType="clyde",trailing:React.createElement(FormRow.Arrow,null),selected:vstorage.previewType==="clyde",style:{marginHorizontal:12}})))}var import_metro6=__toESM(require_metro(),1),import_common9=__toESM(require_common(),1),import_patcher3=__toESM(require_patcher(),1),import_utils=__toESM(require_utils(),1);var import_metro3=__toESM(require_metro(),1),import_common5=__toESM(require_common(),1),{intl,t:intlMap}=(0,import_metro3.findByProps)("intl")??{},{runtimeHashMessageKey}=(0,import_metro3.findByProps)("runtimeHashMessageKey")??{},isUsingi18n=!!import_common5.i18n.Messages.DISCORD||!intl||!intlMap||!runtimeHashMessageKey,_messages={},intlProxy=Object.freeze(new Proxy(_messages,{get(trg,prop,receiv){var key=prop.toString();if(key in _messages)return Reflect.get(trg,key,receiv);if(isUsingi18n)return _messages[key]=import_common5.i18n.Messages[key];var hash=runtimeHashMessageKey(key);try{return _messages[key]=intl.string(intlMap[hash])}catch(e){return console.warn(`intlProxy: Failed to get intl message for key: ${key} (${hash})`,e),_messages[key]=""}}})),_format={},intlFormat=Object.freeze(new Proxy(_format,{get(trg,prop,receiv){var key=prop.toString();if(key in _format)return Reflect.get(trg,key,receiv);if(isUsingi18n)return _format[key]=typeof import_common5.i18n.Messages[key]=="string"?()=>import_common5.i18n.Messages[key]:import_common5.i18n.Messages[key].format;var hash=runtimeHashMessageKey(key);try{return _format[key]=values=>intl.format(intlMap[hash],values)}catch(e){return console.warn(`intlFormat: Failed to get intl format message for key: ${key} (${hash})`,e),_format[key]=()=>""}}})),intlProxy_default=intlProxy;var import_common8=__toESM(require_common(),1),import_patcher=__toESM(require_patcher(),1),import_ui3=__toESM(require_ui(),1),import_assets3=__toESM(require_assets(),1);var import_metro4=__toESM(require_metro(),1),import_common6=__toESM(require_common(),1);var WebView=(0,import_metro4.find)(x=>x?.WebView&&!x.default).WebView,Svg=(0,import_metro4.findByProps)("SvgXml"),Reanimated=(0,import_metro4.findByProps)("useSharedValue"),FlashList=(0,import_metro4.findByProps)("FlashList").FlashList,{default:Video}=(0,import_metro4.findByProps)("DRMType","FilterType"),Joi=(0,import_metro4.findByProps)("isJoi"),zustand=(0,import_metro4.findByProps)("create","useStore")??{create:(0,import_metro4.findByName)("create")},DocumentPicker=(0,import_metro4.findByProps)("pickSingle","isCancel"),_MAS=(0,import_metro4.findByProps)("MobileAudioSound").MobileAudioSound;var RNCacheModule=import_common6.ReactNative.NativeModules.MMKVManager??import_common6.ReactNative.NativeModules.NativeCacheModule,RNChatModule=import_common6.ReactNative.NativeModules.DCDChatManager??import_common6.ReactNative.NativeModules.NativeChatModule,RNFileModule=import_common6.ReactNative.NativeModules.RTNFileManager??import_common6.ReactNative.NativeModules.DCDFileManager??import_common6.ReactNative.NativeModules.NativeFileModule;var import_metro5=__toESM(require_metro(),1),import_common7=__toESM(require_common(),1),import_alerts=__toESM(require_alerts(),1);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}var{default:ChatItemWrapper}=(0,import_metro5.findByProps)("DCDAutoModerationSystemMessageView","default"),MessageRecord=(0,import_metro5.findByName)("MessageRecord"),RowManager=(0,import_metro5.findByName)("RowManager"),SelectedChannelStore=(0,import_metro5.findByStoreName)("SelectedChannelStore"),UserStore=(0,import_metro5.findByStoreName)("UserStore"),UploadAttachmentStore=(0,import_metro5.findByStoreName)("UploadAttachmentStore"),{receiveMessage}=(0,import_metro5.findByProps)("receiveMessage"),{createBotMessage}=(0,import_metro5.findByProps)("createBotMessage"),{getText}=(0,import_metro5.findByProps)("getText"),getAttachments=function(){var _ref=_async_to_generator(function*(channelId){return yield Promise.all(UploadAttachmentStore.getUploads(channelId,0).map(function(){var _ref2=_async_to_generator(function*(upload){var{isImage,uniqueId,filename,spoiler,item}=upload,{uri,mimeType,width,height}=item,attachment={id:uniqueId,filename:spoiler?`SPOILER_${filename}`:filename,content_type:mimeType,size:yield upload.getSize(),spoiler,url:`${uri}#`,proxy_url:`${uri}#`};return isImage&&(attachment.width=width,attachment.height=height),attachment});return function(upload){return _ref2.apply(this,arguments)}}())).catch(()=>[])});return function(channelId){return _ref.apply(this,arguments)}}();function openPreview(){return _openPreview.apply(this,arguments)}function _openPreview(){return _openPreview=_async_to_generator(function*(){var channelId=SelectedChannelStore.getChannelId(),content=getText(channelId,0);if(!(content.trim()===""&&!UploadAttachmentStore.getUploads(channelId).length)){var author=UserStore.getCurrentUser(),attachments=yield getAttachments(channelId);vstorage.previewType==="popup"?(0,import_alerts.showConfirmationAlert)({title:"Message Preview",onConfirm:()=>{},children:React.createElement(import_common7.ReactNative.ScrollView,{style:{marginVertical:12,maxHeight:import_common7.ReactNative.Dimensions.get("window").height*.7}},React.createElement(ChatItemWrapper,{rowGenerator:new RowManager,message:new MessageRecord({id:"0",channel_id:channelId,content,attachments,author})}))}):receiveMessage(channelId,Object.assign(createBotMessage({channelId,content}),{author,attachments}))}}),_openPreview.apply(this,arguments)}var ACTION_ICON_SIZE=40,styles=import_common8.stylesheet.createThemedStyleSheet({androidRipple:{color:import_ui3.semanticColors.ANDROID_RIPPLE,cornerRadius:2147483647},actionButton:{borderRadius:2147483647,height:ACTION_ICON_SIZE,width:ACTION_ICON_SIZE,marginHorizontal:4,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:import_ui3.semanticColors.BACKGROUND_SECONDARY_ALT,marginLeft:8,marginTop:-4},actionIcon:{tintColor:import_ui3.semanticColors.INTERACTIVE_NORMAL,width:ACTION_ICON_SIZE*.6,height:ACTION_ICON_SIZE*.6}}),PreviewButton_default=({inputProps})=>{var[text,setText]=import_common8.React.useState(""),fade=Reanimated.useSharedValue(0);patches.push((0,import_patcher.after)("onChangeText",inputProps,([txt])=>setText(txt),!0));var shouldAppear=text.length>0,UseComponent=shouldAppear?import_common8.ReactNative.Pressable:import_common8.ReactNative.View;return import_common8.React.useEffect(()=>{fade.value=Reanimated.withTiming(shouldAppear?1:0,{duration:100})},[shouldAppear]),import_common8.React.createElement(Reanimated.default.View,{style:[{flexDirection:"row",position:"absolute",left:0,top:-ACTION_ICON_SIZE,zIndex:3},{opacity:fade}]},import_common8.React.createElement(UseComponent,{android_ripple:styles.androidRipple,onPress:shouldAppear?()=>openPreview():void 0,style:styles.actionButton},import_common8.React.createElement(import_common8.ReactNative.Image,{style:styles.actionIcon,source:(0,import_assets3.getAssetIDByName)("EyeIcon")})))};var{ChatInput}=(0,import_metro6.findByProps)("ChatInput"),patches=new Array,patcher_default=()=>(patches.push((0,import_patcher3.after)("render",ChatInput.prototype,(_,ret)=>{var props=(0,import_utils.findInReactTree)(ret.props.children,x=>x.type?.name==="ChatInput")?.props;if(props?.onChangeText){var children=(0,import_utils.findInReactTree)(ret.props.children,x=>x.type?.displayName==="View"&&Array.isArray(x.props?.children))?.props?.children;children&&vstorage.buttonType==="pill"&&children.unshift(React.createElement(PreviewButton_default,{inputProps:props}))}})),patches.push((0,import_patcher3.before)("render",import_common9.ReactNative.Pressable.type,([a])=>{a?.accessibilityLabel===intlProxy_default.SEND&&(a.onLongPress=()=>vstorage.buttonType==="send"&&openPreview())})),()=>{for(var x of patches)x()});var vstorage=import_plugin.storage,unpatch,src_default={onLoad:()=>{vstorage.buttonType??="pill",vstorage.previewType??="popup",unpatch=patcher_default()},onUnload:()=>unpatch?.(),settings:Settings_default};return __toCommonJS(src_exports);})();
return $;})();
